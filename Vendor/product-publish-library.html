<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>产品库选择 - 发布商品</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        /* 厂家端样式 */
        .vendor-header {
            background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%);
        }
        
        /* 导航样式 */
        .nav-item {
            transition: all 0.3s ease;
        }
        .nav-item:hover {
            background-color: rgba(255, 255, 255, 0.1);
        }
        .nav-item.active {
            background-color: rgba(255, 255, 255, 0.2);
            font-weight: 600;
        }
        
        /* 按钮样式 */
        .btn-primary {
            background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%);
            transition: all 0.3s ease;
        }
        .btn-primary:hover {
            background: linear-gradient(135deg, #2563eb 0%, #1d4ed8 100%);
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(59, 130, 246, 0.3);
        }
        
        /* 搜索结果样式 */
        .product-item {
            transition: all 0.2s ease;
            cursor: pointer;
        }
        
        .product-item:hover {
            background-color: #f3f4f6;
        }
        
        /* 加载动画 */
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(59, 130, 246, 0.3);
            border-radius: 50%;
            border-top-color: #3b82f6;
            animation: spin 1s ease-in-out infinite;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
    </style>
</head>
<body class="bg-gray-50">
    <!-- 顶部导航 -->
    <header class="bg-white shadow-md px-6 py-4">
        <div class="flex items-center justify-between">
            <div>
                <h2 class="text-xl font-bold text-gray-800">欢迎回来，山东种业集团</h2>
                <p class="text-sm text-gray-600">今天是 2024年1月15日 星期一</p>
            </div>
            <div class="flex items-center space-x-4">
                <button class="relative p-2 text-gray-600 hover:text-blue-600 transition">
                    <i class="fas fa-bell text-xl"></i>
                    <span class="absolute -top-1 -right-1 w-5 h-5 bg-red-500 text-white text-xs rounded-full flex items-center justify-center">3</span>
                </button>
                <div class="flex items-center space-x-3">
                    <div class="w-10 h-10 bg-blue-100 rounded-full flex items-center justify-center">
                        <i class="fas fa-user text-blue-600"></i>
                    </div>
                    <div>
                        <p class="text-sm font-medium text-gray-800">张经理</p>
                        <p class="text-xs text-gray-600">厂家管理员</p>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- 侧边导航 -->
    <aside class="w-64 bg-blue-800 text-white flex-shrink-0 fixed left-0 top-0 h-screen">
        <div class="p-4 border-b border-blue-700">
            <div class="flex items-center space-x-3 cursor-pointer" onclick="window.location.href='index.html'">
                <i class="fas fa-leaf text-2xl"></i>
                <div>
                    <h1 class="text-lg font-bold">农资商城</h1>
                    <p class="text-xs text-blue-200">厂家管理后台</p>
                </div>
            </div>
        </div>
        <nav class="p-4">
            <ul class="space-y-2">
                <li>
                    <a href="index.html" class="flex items-center space-x-3 px-4 py-3 hover:bg-blue-700 rounded-lg transition">
                        <i class="fas fa-home"></i>
                        <span>首页</span>
                    </a>
                </li>
                <li>
                    <a href="products.html" class="flex items-center space-x-3 px-4 py-3 bg-blue-700 rounded-lg">
                        <i class="fas fa-boxes"></i>
                        <span>商品管理</span>
                    </a>
                </li>
                <li>
                    <a href="orders.html" class="flex items-center space-x-3 px-4 py-3 hover:bg-blue-700 rounded-lg transition">
                        <i class="fas fa-clipboard-list"></i>
                        <span>订单管理</span>
                    </a>
                </li>
                <li>
                    <a href="inventory.html" class="flex items-center space-x-3 px-4 py-3 hover:bg-blue-700 rounded-lg transition">
                        <i class="fas fa-warehouse"></i>
                        <span>库存管理</span>
                    </a>
                </li>
                <li>
                    <a href="finance.html" class="flex items-center space-x-3 px-4 py-3 hover:bg-blue-700 rounded-lg transition">
                        <i class="fas fa-dollar-sign"></i>
                        <span>财务管理</span>
                    </a>
                </li>
                <li>
                    <a href="analytics.html" class="flex items-center space-x-3 px-4 py-3 hover:bg-blue-700 rounded-lg transition">
                        <i class="fas fa-chart-line"></i>
                        <span>数据统计</span>
                    </a>
                </li>
                <li>
                    <a href="settings.html" class="flex items-center space-x-3 px-4 py-3 hover:bg-blue-700 rounded-lg transition">
                        <i class="fas fa-cog"></i>
                        <span>系统设置</span>
                    </a>
                </li>
            </ul>
        </nav>
        <div class="absolute bottom-0 w-64 p-4 border-t border-blue-700">
            <a href="#" class="flex items-center space-x-3 px-4 py-3 hover:bg-blue-700 rounded-lg transition">
                <i class="fas fa-sign-out-alt"></i>
                <span>退出登录</span>
            </a>
        </div>
    </aside>

    <!-- 主内容区 -->
    <div class="container mx-auto px-4 py-8 ml-64">
        <div class="flex flex-col md:flex-row gap-6">

            <!-- 主内容区 -->
            <main class="flex-1">
                <!-- 页面标题 -->
                <div class="bg-white rounded-xl shadow-md p-6 mb-6">
                    <div class="flex items-center justify-between">
                        <div>
                            <h2 class="text-2xl font-bold text-gray-800">产品库选择</h2>
                            <p class="text-gray-500 mt-1">从平台产品库中搜索并选择商品进行发布</p>
                        </div>
                        <a href="product-publish.html" class="btn-primary px-4 py-2 rounded-lg text-white flex items-center space-x-2 hover:no-underline">
                            <i class="fas fa-arrow-left"></i>
                            <span>返回发布页面</span>
                        </a>
                    </div>
                </div>

                <!-- 搜索区域 -->
                <div class="bg-white rounded-xl shadow-md p-6 mb-6">
                    <div class="flex flex-col md:flex-row gap-4">
                        <div class="flex-1 relative">
                            <input type="text" id="product-search" placeholder="请输入商品名称、品牌或登记证号" 
                                   class="w-full px-4 py-3 pr-12 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                            <button type="button" onclick="searchProducts()" 
                                    class="absolute right-2 top-1/2 transform -translate-y-1/2 px-3 py-1 bg-blue-600 text-white rounded text-sm hover:bg-blue-700">
                                <i class="fas fa-search"></i>
                            </button>
                        </div>
                        <div>
                            <select id="product-category" 
                                    class="w-full md:w-48 px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                                <option value="">全部分类</option>
                                <option value="fertilizer">化肥</option>
                                <option value="pesticide">农药</option>
                                <option value="seed">种子</option>
                                <option value="tools">农具</option>
                            </select>
                        </div>
                    </div>
                </div>

                <!-- 搜索结果 -->
                <div class="bg-white rounded-xl shadow-md p-6">
                    <div class="flex items-center justify-between mb-4">
                        <h3 class="text-lg font-semibold text-gray-800">搜索结果</h3>
                        <div id="result-count" class="text-sm text-gray-500"></div>
                    </div>
                    
                    <!-- 加载状态 -->
                    <div id="loading" class="hidden product-item p-4 border border-gray-200 rounded-lg text-center py-8">
                        <div class="loading mx-auto mb-4"></div>
                        <p class="text-gray-600">正在搜索商品...</p>
                    </div>
                    
                    <!-- 空结果状态 -->
                    <div id="no-results" class="hidden product-item p-4 border border-gray-200 rounded-lg text-center py-8">
                        <i class="fas fa-search text-4xl text-gray-400 mb-4"></i>
                        <h4 class="text-lg font-medium text-gray-600 mb-2">未找到匹配的商品</h4>
                        <p class="text-sm text-gray-500">请尝试调整搜索条件</p>
                    </div>
                    
                    <!-- 商品列表 -->
                    <ul id="product-list" class="space-y-3">
                        <!-- 商品列表将通过JavaScript动态生成 -->
                    </ul>
                    
                    <!-- 分页 -->
                    <div id="pagination" class="mt-6 flex justify-center">
                        <!-- 分页按钮将通过JavaScript动态生成 -->
                    </div>
                </div>
            </main>
        </div>
    </div>

    <script>
        // 模拟产品库数据
        const productLibrary = [
            {
                id: 1,
                name: '高效复合肥',
                brand: '丰收牌',
                category: 'fertilizer',
                origin: '山东',
                model: '颗粒',
                registrationCert: '证号1',
                registrationDateStart: '2023-01-01',
                registrationDateEnd: '2028-12-31',
                productionLicense: 'SC1234567890',
                standardNumber: 'GB15063-2020',
                barcode: '6901234567890',
                activeIngredient: 'N-P-K 15-15-15',
                content: '45%',
                targetCrops: '小麦、玉米、水稻',
                controlObjects: '',
                baseUnit: 'kg',
                shelfLife: '365',
                usageMethod: '作为基肥或追肥使用，每亩用量20-30kg',
                notes: '存放于阴凉干燥处'
            },
            {
                id: 2,
                name: '杀虫剂',
                brand: '绿保',
                category: 'pesticide',
                origin: '江苏',
                model: '液体',
                toxicity: '低毒',
                registrationCert: '证号2',
                registrationDateStart: '2022-06-01',
                registrationDateEnd: '2027-05-31',
                productionLicense: 'SC0987654321',
                standardNumber: 'GB/T 19136-2003',
                barcode: '6912345678901',
                activeIngredient: '氯氰菊酯 2.5%',
                content: '2.5%',
                targetCrops: '棉花、蔬菜',
                controlObjects: '蚜虫、菜青虫',
                baseUnit: 'ml',
                shelfLife: '24',
                usageMethod: '稀释1000倍液喷雾，每亩用量50ml',
                notes: '避免与碱性农药混用'
            },
            {
                id: 3,
                name: '杂交水稻种子',
                brand: '隆平高科',
                category: 'seed',
                origin: '湖南',
                model: '种子',
                registrationCert: '证号3',
                registrationDateStart: '2021-03-01',
                registrationDateEnd: '2026-02-28',
                productionLicense: 'SC5678901234',
                standardNumber: 'GB 4404.1-2008',
                barcode: '6923456789012',
                activeIngredient: '',
                content: '',
                targetCrops: '水稻',
                controlObjects: '',
                baseUnit: 'kg',
                shelfLife: '12',
                usageMethod: '每亩用种量1.5-2kg，浸种催芽后播种',
                notes: '保持干燥密封保存'
            },
            {
                id: 4,
                name: '除草剂',
                brand: '草无踪',
                category: 'pesticide',
                origin: '浙江',
                model: '液体',
                toxicity: '低毒',
                registrationCert: '证号4',
                registrationDateStart: '2023-03-01',
                registrationDateEnd: '2028-02-28',
                productionLicense: 'SC1122334455',
                standardNumber: 'GB/T 20684-2006',
                barcode: '6934567890123',
                activeIngredient: '草甘膦 41%',
                content: '41%',
                targetCrops: '农田、果园',
                controlObjects: '一年生和多年生杂草',
                baseUnit: 'l',
                shelfLife: '24',
                usageMethod: '稀释200倍液喷雾，每亩用量200ml',
                notes: '避免接触作物叶片'
            },
            {
                id: 5,
                name: '有机肥',
                brand: '生态源',
                category: 'fertilizer',
                origin: '河南',
                model: '颗粒',
                registrationCert: '证号5',
                registrationDateStart: '2022-01-01',
                registrationDateEnd: '2027-12-31',
                productionLicense: 'SC6677889900',
                standardNumber: 'NY 525-2021',
                barcode: '6945678901234',
                activeIngredient: '有机质 ≥45%',
                content: '有机质 ≥45%',
                targetCrops: '蔬菜、花卉',
                controlObjects: '',
                baseUnit: 'kg',
                shelfLife: '18',
                usageMethod: '作为基肥使用，每亩用量100-200kg',
                notes: '与化肥配合使用效果更佳'
            }
        ];
        
        // 搜索商品功能
        function searchProducts() {
            const searchTerm = document.getElementById('product-search').value.trim().toLowerCase();
            const categoryFilter = document.getElementById('product-category').value;
            const loading = document.getElementById('loading');
            const noResults = document.getElementById('no-results');
            const productList = document.getElementById('product-list');
            const resultCount = document.getElementById('result-count');
            
            // 显示加载状态
            loading.classList.remove('hidden');
            noResults.classList.add('hidden');
            productList.innerHTML = '';
            
            // 模拟搜索延迟
            setTimeout(() => {
                // 过滤商品
                let filteredProducts = productLibrary;
                
                if (searchTerm) {
                    filteredProducts = filteredProducts.filter(product => 
                        product.name.toLowerCase().includes(searchTerm) ||
                        product.brand.toLowerCase().includes(searchTerm) ||
                        product.registrationCert.toLowerCase().includes(searchTerm) ||
                        product.productionLicense.toLowerCase().includes(searchTerm)
                    );
                }
                
                if (categoryFilter) {
                    filteredProducts = filteredProducts.filter(product => 
                        product.category === categoryFilter
                    );
                }
                
                // 隐藏加载状态
                loading.classList.add('hidden');
                
                // 显示结果
                if (filteredProducts.length === 0) {
                    noResults.classList.remove('hidden');
                    resultCount.textContent = '找到 0 个商品';
                } else {
                    resultCount.textContent = `找到 ${filteredProducts.length} 个商品`;
                    
                    // 生成商品列表
                    filteredProducts.forEach(product => {
                        const productItem = document.createElement('li');
                        productItem.className = 'product-item p-4 border border-gray-200 rounded-lg hover:shadow-md';
                        productItem.onclick = function(event) { selectProduct(event, product); };
                        
                        productItem.innerHTML = `
                            <div class="flex items-start justify-between">
                                <div class="flex-1">
                                    <h4 class="font-medium text-gray-800 mb-1">${product.name}</h4>
                                    <div class="text-sm text-gray-500 space-y-1">
                                        <div>品牌：${product.brand}</div>
                                        <div>类别：${getCategoryName(product.category)}</div>
                                        <div>产地：${product.origin}</div>
                                        <div>登记证号：${product.registrationCert}</div>
                                    </div>
                                </div>
                            </div>
                        `;
                        
                        productList.appendChild(productItem);
                    });
                }
            }, 1000);
        }
        
        // 获取类别名称
        function getCategoryName(categoryValue) {
            const categoryMap = {
                'fertilizer': '化肥',
                'pesticide': '农药',
                'seed': '种子',
                'tools': '农具'
            };
            return categoryMap[categoryValue] || categoryValue;
        }
        
        // 选择商品函数
        function selectProduct(event, product) {
            // 获取当前点击的商品项
            const productItem = event.currentTarget;
            
            // 添加选中加深效果
            productItem.classList.add('bg-blue-50', 'border-blue-300', 'shadow-md');
            
            // 模拟选中动画延迟
            setTimeout(() => {
                try {
                    // 确认商品数据是否存在
                    if (!product || !product.id) {
                        alert('商品数据无效，请重新选择');
                        productItem.classList.remove('bg-blue-50', 'border-blue-300', 'shadow-md');
                        return;
                    }
                    
                    // 跳转到发布页面并填充商品信息
                    const confirmRedirect = confirm(`已选择商品：${product.name}\n\n系统将跳转到商品发布页面并自动填充商品信息。\n\n点击确定继续，取消返回。`);
                    
                    if (confirmRedirect) {
                        // 只传递商品ID，简化URL参数
                        const redirectUrl = `product-publish.html?productId=${product.id}`;
                        console.log('准备跳转到:', redirectUrl);
                        console.log('商品ID:', product.id);
                        
                        // 执行跳转
                        window.location.href = redirectUrl;
                    } else {
                        console.log('用户取消了跳转');
                        // 如果用户取消，移除选中效果
                        productItem.classList.remove('bg-blue-50', 'border-blue-300', 'shadow-md');
                    }
                } catch (error) {
                    console.error('跳转过程中发生错误:', error);
                    alert('跳转错误：' + error.message + '，请重试');
                    // 移除选中效果
                    productItem.classList.remove('bg-blue-50', 'border-blue-300', 'shadow-md');
                }
            }, 300);
        }
        
        // 页面加载完成后自动搜索
        document.addEventListener('DOMContentLoaded', function() {
            // 添加回车键搜索功能
            const searchInput = document.getElementById('product-search');
            searchInput.addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    searchProducts();
                }
            });
            
            // 初始加载所有商品
            searchProducts();
        });
    </script>
</body>
</html>